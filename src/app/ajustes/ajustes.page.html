<ion-header>
  <ion-toolbar>
    <div class="header-container">
      <h1>Ajustes</h1>
      <ion-button fill="clear" class="back-button" (click)="goBack()">
        <ion-icon name="arrow-back-circle"></ion-icon>
        Atrás
      </ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="ajustes-content">
  <ion-banner *ngIf="!sheetAvailable" color="danger">
    <ion-label>Google Sheets no disponible. <ion-button fill="clear" (click)="loadUsuarios()">Reintentar</ion-button></ion-label>
  </ion-banner>
  <ion-list>
    <ion-item class="ajustes-item">
      <ion-icon name="moon" slot="start" class="ajustes-icon"></ion-icon>
      <ion-label>
        <h2>Modo Oscuro</h2>
        <p>Activa el tema oscuro</p>
      </ion-label>
      <ion-toggle [checked]="darkMode" (ionChange)="toggleDarkMode($event)"></ion-toggle>
    </ion-item>

    <ion-item class="ajustes-item">
      <ion-icon name="notifications" slot="start" class="ajustes-icon"></ion-icon>
      <ion-label>
        <h2>Notificaciones</h2>
        <p>Recibe alertas de la app</p>
      </ion-label>
      <ion-toggle [checked]="notificaciones" (ionChange)="toggleNotificaciones($event)"></ion-toggle>
    </ion-item>

    <ion-item class="ajustes-item" button (click)="openModal()">
      <ion-icon name="person-circle" slot="start" class="ajustes-icon"></ion-icon>
      <ion-label>
        <h2>Cambiar usuario y contraseña</h2>
        <p>Actualiza tus credenciales</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Modal para cambiar usuario y contraseña -->
  <ion-modal [isOpen]="isModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Cambiar Credenciales</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <form [formGroup]="changePasswordForm" (ngSubmit)="saveChanges()">
          <ion-item>
            <ion-label position="stacked">Cambiar nombre de usuario</ion-label>
            <ion-input type="text" formControlName="username" placeholder="Nuevo nombre de usuario"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Cambiar contraseña</ion-label>
            <ion-input type="password" formControlName="password" placeholder="Nueva contraseña (mín. 6 caracteres)"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Confirmar contraseña</ion-label>
            <ion-input type="password" formControlName="confirmPassword" placeholder="Confirma tu nueva contraseña"></ion-input>
          </ion-item>

          <div *ngIf="changePasswordForm.errors?.['mismatch'] && changePasswordForm.get('confirmPassword')?.touched" class="error-message">
            Las contraseñas no coinciden
          </div>

          <ion-button expand="block" type="submit" class="ion-margin-top" [disabled]="changePasswordForm.invalid">
            Guardar cambios
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
